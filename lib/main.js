(function() {
  var $, BYTEWISE, CND, D, _btws_decode, _btws_encode, _new_level_db, badge, debug, echo, help, log, rpr, step, suspend, urge, warn,
    slice = [].slice;

  CND = require('cnd');

  rpr = CND.rpr;

  badge = 'test-hollerith';

  log = CND.get_logger('plain', badge);

  debug = CND.get_logger('debug', badge);

  warn = CND.get_logger('warn', badge);

  help = CND.get_logger('help', badge);

  urge = CND.get_logger('urge', badge);

  echo = CND.echo.bind(CND);

  suspend = require('coffeenode-suspend');

  step = suspend.step;

  BYTEWISE = require('bytewise');

  _btws_encode = BYTEWISE.encode.bind(BYTEWISE);

  _btws_decode = BYTEWISE.decode.bind(BYTEWISE);

  D = require('pipedreams2');

  $ = D.remit.bind(D);

  _new_level_db = require('level');

  this._zero = _btws_encode(true);

  this._last_octet = new Buffer([0xff]);

  this.new_db = function(route) {
    var R, level_settings, substrate;
    level_settings = {
      'keyEncoding': 'binary',
      'valueEncoding': 'binary',
      'createIfMissing': true,
      'errorIfExists': false,
      'compression': true,
      'sync': false
    };
    substrate = _new_level_db(route, level_settings);
    R = {
      '~isa': 'HOLLERITH/db',
      '%self': substrate
    };
    return R;
  };

  this.clear = function(db, handler) {

    /* TAINT consider to simply remove files as it is faster and leads to more reproducible results as
    we then always really start from scratch
     */
    var count, input, substrate;
    substrate = db['%self'];
    input = substrate.createKeyStream();
    count = 0;
    return input.pipe($((function(_this) {
      return function(key, send, end) {
        return step(function*(resume) {
          if (key != null) {
            count += +1;
            (yield substrate.del(key, resume));
          }
          if (end != null) {
            help("deleted " + count + " entries");
            if (handler != null) {
              return handler(null);
            }
          }
        });
      };
    })(this)));
  };

  this._encode = function(db, key) {
    return _btws_encode(key);
  };

  this._decode = function(db, key) {
    return _btws_decode(key);
  };

  this.read = function(db, prefix) {
    if (prefix == null) {
      prefix = null;
    }
    if (prefix == null) {
      return db['%self'].createKeyStream();
    }
    return db['%self'].createKeyStream(this._query_from_prefix);
  };

  this.read_sub = function(db, settings, read) {
    var arity, indexed, insert_index, open_stream_count, ref;
    switch (arity = arguments.length) {
      case 2:
        read = settings;
        settings = null;
        break;
      case 3:
        null;
        break;
      default:
        throw new Error("expected 2 or 3 arguments, got " + arity);
    }
    indexed = (ref = settings != null ? settings['indexed'] : void 0) != null ? ref : false;
    insert_index = indexed ? D.new_indexer() : function(x) {
      return x;
    };
    open_stream_count = 0;
    return $((function(_this) {
      return function(outer_data, outer_send, outer_end) {
        var sub_input;
        if (outer_data != null) {
          open_stream_count += +1;
          sub_input = read(outer_data).pipe((function() {
            var buffer;
            buffer = [];
            return $(function(inner_data, _, inner_end) {
              if (inner_data != null) {
                buffer.push(inner_data);
              }
              if (inner_end != null) {
                outer_send(insert_index(buffer));
                return open_stream_count += -1;
              }
            });
          })());
        }
        if (outer_end != null) {
          return repeat_immediately(function() {
            if (open_stream_count !== 0) {
              return true;
            }
            outer_end();
            return false;
          });
        }
      };
    })(this));
  };

  this.new_key = function(db, phrasetype, key_0, value_0, key_1, value_1, idx) {
    if (phrasetype !== '<' && phrasetype !== '>') {
      throw new Error("illegal phrasetype: " + (rpr(key)));
    }
    return [phrasetype, [key_0, value_0], [key_1, value_1], idx != null ? idx : null];
  };

  this.new_so_key = function() {
    var P, db;
    db = arguments[0], P = 2 <= arguments.length ? slice.call(arguments, 1) : [];
    return this.new_key.apply(this, [db, 'so'].concat(slice.call(P)));
  };

  this.new_os_key = function() {
    var P, db;
    db = arguments[0], P = 2 <= arguments.length ? slice.call(arguments, 1) : [];
    return this.new_key.apply(this, [db, 'os'].concat(slice.call(P)));
  };

  this.new_keys = function(db, phrasetype, key_0, value_0, key_1, value_1, idx) {
    var other_phrasetype;
    other_phrasetype = phrasetype === 'so' ? 'os' : 'so';
    return [this.new_key(db, phrasetype, key_0, value_0, key_1, value_1, idx), this.new_key(db, other_phrasetype, key_1, value_1, key_0, value_0, idx)];
  };

  this.new_prefix = function() {
    var db, elements, phrasetype;
    db = arguments[0], phrasetype = arguments[1], elements = 3 <= arguments.length ? slice.call(arguments, 2) : [];
    throw new Error("xxxxxxxxxx");
  };

  this._query_from_prefix = function(db, prefix) {
    var gte, last_gte_idx, lte;
    gte = Buffer.isBuffer(prefix) ? prefix : this._encode(db, prefix);

    /* `BYTEWISE` encodes lists with zeroes at the end; we skip those zeroes to arrive at a minimal prefix to
    which a `0xff` byte can be meaningfully appended:
     */
    last_gte_idx = gte.length - 1;
    while ((last_gte_idx > 0) && (gte[last_gte_idx] === 0x00)) {
      last_gte_idx += -1;
    }
    if (last_gte_idx < gte.length - 1) {
      gte = gte.slice(0, last_gte_idx + 1);
    }
    lte = Buffer.concat([gte, this._last_octet], gte.length + 1);
    return {
      gte: gte,
      lte: lte
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,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QW5DO0VBQUEsQ0FqSWQsQ0FBQTs7QUFBQSxFQW9JQSxJQUFDLENBQUEsa0JBQUQsR0FBc0IsU0FBRSxFQUFGLEVBQU0sTUFBTixHQUFBO0FBQ3BCLFFBQUEsc0JBQUE7QUFBQSxJQUFBLEdBQUEsR0FBcUIsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsTUFBaEIsQ0FBTCxHQUFtQyxNQUFuQyxHQUErQyxJQUFDLENBQUEsT0FBRCxDQUFTLEVBQVQsRUFBYSxNQUFiLENBQS9ELENBQUE7QUFDQTtBQUFBOztPQURBO0FBQUEsSUFHQSxZQUFBLEdBQWdCLEdBQUcsQ0FBQyxNQUFKLEdBQWEsQ0FIN0IsQ0FBQTtBQUltQixXQUFNLENBQUUsWUFBQSxHQUFlLENBQWpCLENBQUEsSUFBeUIsQ0FBRSxHQUFLLENBQUEsWUFBQSxDQUFMLEtBQXVCLElBQXpCLENBQS9CLEdBQUE7QUFBbkIsTUFBQSxZQUFBLElBQWdCLENBQUEsQ0FBaEIsQ0FBbUI7SUFBQSxDQUpuQjtBQUtBLElBQUEsSUFBaUQsWUFBQSxHQUFlLEdBQUcsQ0FBQyxNQUFKLEdBQWEsQ0FBN0U7QUFBQSxNQUFBLEdBQUEsR0FBZ0IsR0FBRyxDQUFDLEtBQUosQ0FBVSxDQUFWLEVBQWEsWUFBQSxHQUFlLENBQTVCLENBQWhCLENBQUE7S0FMQTtBQUFBLElBTUEsR0FBQSxHQUFnQixNQUFNLENBQUMsTUFBUCxDQUFjLENBQUUsR0FBRixFQUFPLElBQUMsQ0FBQSxXQUFSLENBQWQsRUFBc0MsR0FBRyxDQUFDLE1BQUosR0FBYSxDQUFuRCxDQU5oQixDQUFBO0FBT0EsV0FBTztBQUFBLE1BQUUsS0FBQSxHQUFGO0FBQUEsTUFBTyxLQUFBLEdBQVA7S0FBUCxDQVJvQjtFQUFBLENBcEl0QixDQUFBO0FBQUEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG5cbiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuIyBuanNfdXRpbCAgICAgICAgICAgICAgICAgID0gcmVxdWlyZSAndXRpbCdcbiMgbmpzX3BhdGggICAgICAgICAgICAgICAgICA9IHJlcXVpcmUgJ3BhdGgnXG4jIG5qc19mcyAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlICdmcydcbiMuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuQ05EICAgICAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmUgJ2NuZCdcbnJwciAgICAgICAgICAgICAgICAgICAgICAgPSBDTkQucnByXG5iYWRnZSAgICAgICAgICAgICAgICAgICAgID0gJ3Rlc3QtaG9sbGVyaXRoJ1xubG9nICAgICAgICAgICAgICAgICAgICAgICA9IENORC5nZXRfbG9nZ2VyICdwbGFpbicsICAgICBiYWRnZVxuZGVidWcgICAgICAgICAgICAgICAgICAgICA9IENORC5nZXRfbG9nZ2VyICdkZWJ1ZycsICAgICBiYWRnZVxud2FybiAgICAgICAgICAgICAgICAgICAgICA9IENORC5nZXRfbG9nZ2VyICd3YXJuJywgICAgICBiYWRnZVxuaGVscCAgICAgICAgICAgICAgICAgICAgICA9IENORC5nZXRfbG9nZ2VyICdoZWxwJywgICAgICBiYWRnZVxudXJnZSAgICAgICAgICAgICAgICAgICAgICA9IENORC5nZXRfbG9nZ2VyICd1cmdlJywgICAgICBiYWRnZVxuZWNobyAgICAgICAgICAgICAgICAgICAgICA9IENORC5lY2hvLmJpbmQgQ05EXG4jLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cbnN1c3BlbmQgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlICdjb2ZmZWVub2RlLXN1c3BlbmQnXG5zdGVwICAgICAgICAgICAgICAgICAgICAgID0gc3VzcGVuZC5zdGVwXG4jLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cbkJZVEVXSVNFICAgICAgICAgICAgICAgICAgPSByZXF1aXJlICdieXRld2lzZSdcbl9idHdzX2VuY29kZSAgICAgICAgICAgICAgPSBCWVRFV0lTRS5lbmNvZGUuYmluZCBCWVRFV0lTRVxuX2J0d3NfZGVjb2RlICAgICAgICAgICAgICA9IEJZVEVXSVNFLmRlY29kZS5iaW5kIEJZVEVXSVNFXG4jLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cbkQgICAgICAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlICdwaXBlZHJlYW1zMidcbiQgICAgICAgICAgICAgICAgICAgICAgICAgPSBELnJlbWl0LmJpbmQgRFxuX25ld19sZXZlbF9kYiAgICAgICAgICAgICA9IHJlcXVpcmUgJ2xldmVsJ1xuQF96ZXJvICAgICAgICAgICAgICAgICAgICA9IF9idHdzX2VuY29kZSB0cnVlXG5AX2xhc3Rfb2N0ZXQgICAgICAgICAgICAgID0gbmV3IEJ1ZmZlciBbIDB4ZmYsIF1cblxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBuZXdfZGIgPSAoIHJvdXRlICkgLT5cbiAgIy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuICBsZXZlbF9zZXR0aW5ncyA9XG4gICAgJ2tleUVuY29kaW5nJzogICAgICAgICAgJ2JpbmFyeSdcbiAgICAndmFsdWVFbmNvZGluZyc6ICAgICAgICAnYmluYXJ5J1xuICAgICdjcmVhdGVJZk1pc3NpbmcnOiAgICAgIHRydWVcbiAgICAnZXJyb3JJZkV4aXN0cyc6ICAgICAgICBmYWxzZVxuICAgICdjb21wcmVzc2lvbic6ICAgICAgICAgIHllc1xuICAgICdzeW5jJzogICAgICAgICAgICAgICAgIG5vXG4gICMuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cbiAgc3Vic3RyYXRlICAgICAgICAgICA9IF9uZXdfbGV2ZWxfZGIgcm91dGUsIGxldmVsX3NldHRpbmdzXG4gICMuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cbiAgUiA9XG4gICAgJ35pc2EnOiAgICAgICAgICAgJ0hPTExFUklUSC9kYidcbiAgICAnJXNlbGYnOiAgICAgICAgICBzdWJzdHJhdGVcbiAgIy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuICByZXR1cm4gUlxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBjbGVhciA9ICggZGIsIGhhbmRsZXIgKSAtPlxuICAjIyMgVEFJTlQgY29uc2lkZXIgdG8gc2ltcGx5IHJlbW92ZSBmaWxlcyBhcyBpdCBpcyBmYXN0ZXIgYW5kIGxlYWRzIHRvIG1vcmUgcmVwcm9kdWNpYmxlIHJlc3VsdHMgYXNcbiAgd2UgdGhlbiBhbHdheXMgcmVhbGx5IHN0YXJ0IGZyb20gc2NyYXRjaCAjIyNcbiAgc3Vic3RyYXRlID0gZGJbICclc2VsZicgXVxuICBpbnB1dCAgICAgPSBzdWJzdHJhdGUuY3JlYXRlS2V5U3RyZWFtKClcbiAgY291bnQgICAgID0gMFxuICBpbnB1dFxuICAgIC5waXBlICQgKCBrZXksIHNlbmQsIGVuZCApID0+XG4gICAgICBzdGVwICggcmVzdW1lICkgPT5cbiAgICAgICAgaWYga2V5P1xuICAgICAgICAgIGNvdW50ICs9ICsxXG4gICAgICAgICAgeWllbGQgc3Vic3RyYXRlLmRlbCBrZXksIHJlc3VtZVxuICAgICAgICBpZiBlbmQ/XG4gICAgICAgICAgaGVscCBcImRlbGV0ZWQgI3tjb3VudH0gZW50cmllc1wiXG4gICAgICAgICAgaGFuZGxlciBudWxsIGlmIGhhbmRsZXI/XG5cblxuIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4jIENPREVDXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBfZW5jb2RlID0gKCBkYiwga2V5ICkgLT4gX2J0d3NfZW5jb2RlIGtleVxuQF9kZWNvZGUgPSAoIGRiLCBrZXkgKSAtPiBfYnR3c19kZWNvZGUga2V5XG5cblxuIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4jIFJFQURJTkdcbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQHJlYWQgPSAoIGRiLCBwcmVmaXggPSBudWxsICkgLT5cbiAgcmV0dXJuIGRiWyAnJXNlbGYnIF0uY3JlYXRlS2V5U3RyZWFtKCkgdW5sZXNzIHByZWZpeD9cbiAgcmV0dXJuIGRiWyAnJXNlbGYnIF0uY3JlYXRlS2V5U3RyZWFtIEBfcXVlcnlfZnJvbV9wcmVmaXhcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AcmVhZF9zdWIgPSAoIGRiLCBzZXR0aW5ncywgcmVhZCApIC0+XG4gIHN3aXRjaCBhcml0eSA9IGFyZ3VtZW50cy5sZW5ndGhcbiAgICB3aGVuIDJcbiAgICAgIHJlYWQgICAgICA9IHNldHRpbmdzXG4gICAgICBzZXR0aW5ncyAgPSBudWxsXG4gICAgd2hlbiAzXG4gICAgICBudWxsXG4gICAgZWxzZVxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwiZXhwZWN0ZWQgMiBvciAzIGFyZ3VtZW50cywgZ290ICN7YXJpdHl9XCJcbiAgIy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuICBpbmRleGVkICAgICAgICAgICA9IHNldHRpbmdzP1sgJ2luZGV4ZWQnIF0gPyBub1xuICBpbnNlcnRfaW5kZXggICAgICA9IGlmIGluZGV4ZWQgdGhlbiBELm5ld19pbmRleGVyKCkgZWxzZSAoIHggKSAtPiB4XG4gIG9wZW5fc3RyZWFtX2NvdW50ID0gMFxuICAjLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG4gIHJldHVybiAkICggb3V0ZXJfZGF0YSwgb3V0ZXJfc2VuZCwgb3V0ZXJfZW5kICkgPT5cbiAgICAjLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuICAgIGlmIG91dGVyX2RhdGE/XG4gICAgICBvcGVuX3N0cmVhbV9jb3VudCAgKz0gKzFcbiAgICAgIHN1Yl9pbnB1dCA9IHJlYWQgb3V0ZXJfZGF0YVxuICAgICAgICAucGlwZSBkbyA9PlxuICAgICAgICAgIGJ1ZmZlciA9IFtdXG4gICAgICAgICAgcmV0dXJuICQgKCBpbm5lcl9kYXRhLCBfLCBpbm5lcl9lbmQgKSA9PlxuICAgICAgICAgICAgYnVmZmVyLnB1c2ggaW5uZXJfZGF0YSBpZiBpbm5lcl9kYXRhP1xuICAgICAgICAgICAgaWYgaW5uZXJfZW5kP1xuICAgICAgICAgICAgICBvdXRlcl9zZW5kIGluc2VydF9pbmRleCBidWZmZXJcbiAgICAgICAgICAgICAgb3Blbl9zdHJlYW1fY291bnQgKz0gLTFcbiAgICAjLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuICAgIGlmIG91dGVyX2VuZD9cbiAgICAgIHJlcGVhdF9pbW1lZGlhdGVseSAtPlxuICAgICAgICByZXR1cm4gdHJ1ZSB1bmxlc3Mgb3Blbl9zdHJlYW1fY291bnQgaXMgMFxuICAgICAgICBvdXRlcl9lbmQoKVxuICAgICAgICByZXR1cm4gZmFsc2VcblxuXG4jPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiMgS0VZIEFORCBQUkVGSVhFU1xuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AbmV3X2tleSA9ICggZGIsIHBocmFzZXR5cGUsIGtleV8wLCB2YWx1ZV8wLCBrZXlfMSwgdmFsdWVfMSwgaWR4ICkgLT5cbiAgdGhyb3cgbmV3IEVycm9yIFwiaWxsZWdhbCBwaHJhc2V0eXBlOiAje3JwciBrZXl9XCIgdW5sZXNzIHBocmFzZXR5cGUgaW4gWyAnPCcsICc+JywgXVxuICByZXR1cm4gWyBwaHJhc2V0eXBlLCBbIGtleV8wLCB2YWx1ZV8wLCBdLCBbIGtleV8xLCB2YWx1ZV8xLCBdLCAoIGlkeCA/IG51bGwgKSwgXVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBuZXdfc29fa2V5ID0gKCBkYiwgUC4uLiApIC0+IEBuZXdfa2V5IGRiLCAnc28nLCBQLi4uXG5AbmV3X29zX2tleSA9ICggZGIsIFAuLi4gKSAtPiBAbmV3X2tleSBkYiwgJ29zJywgUC4uLlxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBuZXdfa2V5cyA9ICggZGIsIHBocmFzZXR5cGUsIGtleV8wLCB2YWx1ZV8wLCBrZXlfMSwgdmFsdWVfMSwgaWR4ICkgLT5cbiAgb3RoZXJfcGhyYXNldHlwZSAgPSBpZiBwaHJhc2V0eXBlIGlzICdzbycgdGhlbiAnb3MnIGVsc2UgJ3NvJ1xuICByZXR1cm4gW1xuICAgICggQG5ld19rZXkgZGIsICAgICAgIHBocmFzZXR5cGUsIGtleV8wLCB2YWx1ZV8wLCBrZXlfMSwgdmFsdWVfMSwgaWR4ICksXG4gICAgKCBAbmV3X2tleSBkYiwgb3RoZXJfcGhyYXNldHlwZSwga2V5XzEsIHZhbHVlXzEsIGtleV8wLCB2YWx1ZV8wLCBpZHggKSwgXVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBuZXdfcHJlZml4ID0gKCBkYiwgcGhyYXNldHlwZSwgZWxlbWVudHMuLi4gKSAtPiB0aHJvdyBuZXcgRXJyb3IgXCJ4eHh4eHh4eHh4XCJcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AX3F1ZXJ5X2Zyb21fcHJlZml4ID0gKCBkYiwgcHJlZml4ICkgLT5cbiAgZ3RlICAgICAgICAgICA9IGlmICggQnVmZmVyLmlzQnVmZmVyIHByZWZpeCApIHRoZW4gcHJlZml4IGVsc2UgQF9lbmNvZGUgZGIsIHByZWZpeFxuICAjIyMgYEJZVEVXSVNFYCBlbmNvZGVzIGxpc3RzIHdpdGggemVyb2VzIGF0IHRoZSBlbmQ7IHdlIHNraXAgdGhvc2UgemVyb2VzIHRvIGFycml2ZSBhdCBhIG1pbmltYWwgcHJlZml4IHRvXG4gIHdoaWNoIGEgYDB4ZmZgIGJ5dGUgY2FuIGJlIG1lYW5pbmdmdWxseSBhcHBlbmRlZDogIyMjXG4gIGxhc3RfZ3RlX2lkeCAgPSBndGUubGVuZ3RoIC0gMVxuICBsYXN0X2d0ZV9pZHggKz0gLTEgd2hpbGUgKCBsYXN0X2d0ZV9pZHggPiAwICkgYW5kICggZ3RlWyBsYXN0X2d0ZV9pZHggXSBpcyAweDAwIClcbiAgZ3RlICAgICAgICAgICA9IGd0ZS5zbGljZSAwLCBsYXN0X2d0ZV9pZHggKyAxIGlmIGxhc3RfZ3RlX2lkeCA8IGd0ZS5sZW5ndGggLSAxXG4gIGx0ZSAgICAgICAgICAgPSBCdWZmZXIuY29uY2F0IFsgZ3RlLCBAX2xhc3Rfb2N0ZXQsIF0sIGd0ZS5sZW5ndGggKyAxXG4gIHJldHVybiB7IGd0ZSwgbHRlLCB9XG5cblxuXG5cblxuXG4iXX0=