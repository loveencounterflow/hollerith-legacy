{"version":3,"sources":["main.coffee"],"names":[],"mappings":"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","file":"main.js","sourceRoot":"/source/","sourcesContent":["\n\n############################################################################################################\n# njs_util                  = require 'util'\n# njs_path                  = require 'path'\n# njs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'HOLLERITH/main'\nlog                       = CND.get_logger 'plain',     badge\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nsuspend                   = require 'coffeenode-suspend'\nstep                      = suspend.step\n#...........................................................................................................\nCODEC                     = @CODEC = require './codec'\nDUMP                      = @DUMP  = require './dump'\n_codec_encode             = CODEC.encode.bind CODEC\n_codec_decode             = CODEC.decode.bind CODEC\n#...........................................................................................................\nD                         = require 'pipedreams2'\n$                         = D.remit.bind D\n_new_level_db             = require 'level'\nleveldown                 = require 'level/node_modules/leveldown'\n#...........................................................................................................\nsuspend                   = require 'coffeenode-suspend'\nstep                      = suspend.step\nrepeat_immediately        = suspend.repeat_immediately\n#...........................................................................................................\n@_LODASH                  = require 'lodash'\n#...........................................................................................................\n### https://github.com/b3nj4m/bloom-stream ###\nBloom                     = require 'bloom-stream'\n\n\n#-----------------------------------------------------------------------------------------------------------\n@phrasetypes      = [ 'pos', 'spo', ]\n@_misfit          = Symbol 'misfit'\n@_zero_value_bfr  = new Buffer 'null'\n# warn \"mind inconsistencies in HOLLERITH2/main @_zero_enc etc\"\n# @_zero            = true # ?????????????????????????????\n# @_zero_enc        = _codec_encode [ @_zero,    ]\n# @_lo_enc          = _codec_encode [ null,      ]\n# @_hi_enc          = _codec_encode [ CODEC., ]\n# @_last_octet      = new Buffer [ 0xff, ]\n\n#-----------------------------------------------------------------------------------------------------------\n@new_db = ( route ) ->\n  #.........................................................................................................\n  level_settings =\n    'keyEncoding':          'binary'\n    'valueEncoding':        'binary'\n    'createIfMissing':      yes\n    'errorIfExists':        no\n    'compression':          yes\n    'sync':                 no\n  #.........................................................................................................\n  substrate           = _new_level_db route, level_settings\n  #.........................................................................................................\n  R =\n    '~isa':           'HOLLERITH/db'\n    '%self':          substrate\n  #.........................................................................................................\n  return R\n\n# #-----------------------------------------------------------------------------------------------------------\n# @_reopen = ( db, handler ) ->\n#   step ( resume ) =>\n#     route = db[ '%self' ][ 'location' ]\n#     yield db[ '%self' ].close resume\n#     yield db[ '%self' ].open resume\n#     whisper \"re-opened LevelDB at #{route}\"\n#     handler null\n\n#-----------------------------------------------------------------------------------------------------------\n@clear = ( db, handler ) ->\n  step ( resume ) =>\n    route = db[ '%self' ][ 'location' ]\n    whisper \"closing DB\"\n    yield db[ '%self' ].close resume\n    # whisper \"erasing DB\"\n    yield leveldown.destroy route, resume\n    # whisper \"re-opening DB\"\n    yield db[ '%self' ].open resume\n    whisper \"erased and re-opened LevelDB at #{route}\"\n    handler null\n\n\n#===========================================================================================================\n# METADATA\n#-----------------------------------------------------------------------------------------------------------\n@_put_meta = ( db, name, value, handler ) ->\n  ### TAINT should use own type for metadata ###\n  key_bfr   = @_encode_key db, [ 'meta', name, ]\n  value_bfr = if CND.isa_jsbuffer then value else @_encode_value db, value\n  db[ '%self' ].put key_bfr, value_bfr, ( error ) => handler error if handler?\n\n#-----------------------------------------------------------------------------------------------------------\n@_get_meta = ( db, name, fallback, handler ) ->\n  switch arity = arguments.length\n    when 3\n      handler   = fallback\n      fallback  = @_misfit\n    when 4\n      null\n    else\n      throw new Error \"expected 3 or 4 arguments, got #{arity}\"\n  #.........................................................................................................\n  key_bfr = @_encode_key db, [ 'meta', name, ]\n  db[ '%self' ].get key_bfr, ( error, value ) =>\n    if error?\n      return handler null, fallback if ( error[ 'type' ] is 'NotFoundError' ) and ( fallback isnt @_misfit )\n      return handler error\n    handler null, value\n\n#-----------------------------------------------------------------------------------------------------------\n@_is_meta = ( db, key_bfr ) -> ( ( key_bfr.slice 0, @_meta_prefix.length ).compare @_meta_prefix ) is 0\n\n### TAINT must derive meta key prefix from result of `_put_meta` ###\n@_meta_prefix = new Buffer [ 0x54, 0x6d, 0x65, 0x74, 0x61, 0x00, ]\n\n\n#===========================================================================================================\n# WRITING\n#-----------------------------------------------------------------------------------------------------------\n@$write = ( db, settings ) ->\n  ### TAINT currently loading and saving bloom filter each time a pipeline with `$write` is run ###\n  #.........................................................................................................\n  settings         ?= {}\n  ### Superficial experiments show that a much bigger batch size than 1'000 does not tend to improve\n  throughput; therefore, in order to reduce memory footprint, it seems advisable to leave batch size\n  in the order of around a thousand entries. ###\n  batch_size        = settings[ 'batch'  ] ? 1000\n  solid_predicates  = settings[ 'solids' ] ? []\n  ensure_unique     = settings[ 'unique' ] ? true\n  substrate         = db[ '%self' ]\n  R                 = D.create_throughstream()\n  #.........................................................................................................\n  $index = => $ ( spo, send ) =>\n    ### Analyze SPO key and send all necessary POS facets: ###\n    [ sbj, prd, obj, ] = spo\n    send [ [ 'spo', sbj, prd, ], obj, ]\n    obj_type = CND.type_of obj\n    #.......................................................................................................\n    unless obj_type is 'pod'\n      #.....................................................................................................\n      if ( obj_type is 'list' ) and not ( prd in solid_predicates )\n        for obj_element, obj_idx in obj\n          send [ [ 'pos', prd, obj_element, sbj, obj_idx, ], ]\n      #.....................................................................................................\n      else\n        send [ [ 'pos', prd, obj, sbj, ], ]\n  #.........................................................................................................\n  $encode = => $ ( facet, send ) =>\n    [ key, value, ] = facet\n    phrasetype      = key[ 0 ]\n    key_bfr         = @_encode_key db, key\n    value_bfr       = if value? then @_encode_value db, value else @_zero_value_bfr\n    send [ phrasetype, key_bfr, value_bfr, ]\n  #.........................................................................................................\n  $as_batch_entry = => $ ( facet_bfr_plus, send ) =>\n    [ phrasetype, key_bfr, value_bfr, ] = facet_bfr_plus\n    send type: 'put', key: key_bfr, value: value_bfr\n  #.........................................................................................................\n  $write = => $ ( batch, send ) =>\n    substrate.batch batch\n  #.........................................................................................................\n  if ensure_unique\n    { $ensure_unique_spo, $load_bloom, $save_bloom, } = @_get_bloom_methods db\n  #.........................................................................................................\n  pipeline = []\n  pipeline.push $load_bloom()     if ensure_unique\n  pipeline.push $index()\n  pipeline.push $encode()\n  pipeline.push $ensure_unique_spo()  if ensure_unique\n  pipeline.push $as_batch_entry()\n  pipeline.push D.$batch batch_size\n  pipeline.push $write()\n  pipeline.push $save_bloom()     if ensure_unique\n  #.........................................................................................................\n  R.pipe D.combine pipeline...\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@_get_bloom_methods = ( db ) ->\n  #---------------------------------------------------------------------------------------------------------\n  db_size           = db[ 'size' ] ? 10\n  db_size           = db[ 'size' ] ? 1e4\n  db_size           = db[ 'size' ] ? 1e6\n  bloom_error_rate  = 0.1\n  #.........................................................................................................\n  BSON = ( require 'bson' ).BSONPure.BSON\n  njs_fs = require 'fs'\n  #.........................................................................................................\n  BLOEM             = require 'bloem'\n  bloem_settings    =\n    initial_capacity:   db_size * 3\n    scaling:            2\n    ratio:              0.1\n  #---------------------------------------------------------------------------------------------------------\n  show_bloom_info = =>\n    bloom       = db[ '%bloom' ]\n    filters     = bloom[ 'filters' ]\n    filter_size = 0\n    ƒ           = CND.format_number\n    for filter in filters\n      filter_size += filter[ 'filter' ][ 'bitfield' ][ 'buffer' ].length\n    whisper \"scalable Bloom filter size: #{ƒ filter_size} bytes\"\n    whisper bloem_settings\n  #---------------------------------------------------------------------------------------------------------\n  $ensure_unique_spo = =>\n    ### We skip all phrases except for SPO entries, the problem being that even IF some erroneous processing\n    should result in bogus `[ 'pos', 'foo', 'bar', 'baz', ]` tuples, fact is that the object value of that\n    bogus phrase gets right into the key—which may or may not be on record. In other words, you could still\n    create millions of wrong entries like `[ 'pos', 'weighs', kgs, 'my-rabbit' ]` for non-existing (but in\n    themselves, were those actually on record, repetitive) assertions like `[ 'spo', 'my-rabbit', 'weighs',\n    kgs, ]` for any possible value of `kgs` without ever being caught by the no-duplicates restriction.\n\n    It seems better to forgo this test as it only incurs a performance and space burden without being really\n    helpful (a worthwhile alternative would be to check that for all SPO entries there are all the POS\n    entries and that there are no extraneous POS entries, which is even more of a computational burden, but\n    at least reaches a meaningful level of safety against malformed data. ###\n    #.......................................................................................................\n    return D.$map ( xphrase, handler ) =>\n      ### Skip if this is not a main entry to the DB: ###\n      return handler null, xphrase unless xphrase[ 0 ] is 'spo'\n      key_bfr             = xphrase[ 1 ]\n      bloom               = db[ '%bloom' ]\n      bloom_has_key       = bloom.has key_bfr\n      bloom.add key_bfr\n      return handler null, xphrase unless bloom_has_key\n      debug '©nG3mr', ( +new Date() ), \"Bloom filter cache miss\"\n      #.....................................................................................................\n      @has db, key_bfr, ( error, db_has_key ) =>\n        return handler error if error?\n        return handler new Error \"phrase already in DB: #{rpr phrase}\" if db_has_key\n        handler null, xphrase\n  #---------------------------------------------------------------------------------------------------------\n  $load_bloom = =>\n    is_first = yes\n    return D.$map ( data, handler ) =>\n      unless is_first\n        return if data? then handler null, data else handler()\n      #.....................................................................................................\n      is_first = no\n      whisper \"loading Bloom filter...\"\n      #.....................................................................................................\n      @_get_meta db, 'bloom', null, ( error, bloom_bfr ) =>\n        return handler error if error?\n        if bloom_bfr is null\n          warn 'no bloom filter found'\n          bloom = new BLOEM.ScalingBloem bloom_error_rate, bloem_settings\n        else\n          bloom_data = BSON.deserialize bloom_bfr\n          ### TAINT see https://github.com/wiedi/node-bloem/issues/5 ###\n          for filter in bloom_data[ 'filters' ]\n            bitfield              = filter[ 'filter' ][ 'bitfield' ]\n            bitfield[ 'buffer' ]  = bitfield[ 'buffer' ][ 'buffer' ]\n          bloom = BLOEM.ScalingBloem.destringify bloom_data\n        db[ '%bloom' ] = bloom\n        whisper \"...ok\"\n        show_bloom_info()\n        return if data? then handler null, data else handler()\n  #---------------------------------------------------------------------------------------------------------\n  $save_bloom = =>\n    return D.$on_end ( send, end ) =>\n      whisper \"saving Bloom filter...\"\n      bloom     = db[ '%bloom' ]\n      bloom_bfr = BSON.serialize bloom\n      #.....................................................................................................\n      @_put_meta db, 'bloom', bloom_bfr, ( error ) =>\n        return send.error error if error?\n        whisper \"...ok\"\n        end()\n  #---------------------------------------------------------------------------------------------------------\n  return { $ensure_unique_spo, $load_bloom, $save_bloom, }\n\n\n#===========================================================================================================\n# READING\n#-----------------------------------------------------------------------------------------------------------\n@create_phrasestream = ( db, query ) ->\n  return @_create_phrasestream db, query\n\n#-----------------------------------------------------------------------------------------------------------\n@read_phrases = ( db, query, handler ) ->\n  switch arity = arguments.length\n    when 2\n      handler   = query\n      query     = null\n    when 3\n      null\n    else\n      throw new Error \"expected 2 or 3 arguments, got #{arity}\"\n  return @_create_phrasestream db, query, handler\n\n#-----------------------------------------------------------------------------------------------------------\n@read_one_phrase = ( db, query, handler ) ->\n  fallback = @_misfit\n  #.........................................................................................................\n  switch arity = arguments.length\n    when 2\n      handler   = query\n      query     = null\n    when 3\n      null\n    else\n      throw new Error \"expected 4 or 5 arguments, got #{arity}\"\n  #.........................................................................................................\n  if query? and 'fallback' of query\n    fallback = query[ 'fallback' ]\n    delete query[ 'fallback' ]\n  #.........................................................................................................\n  @read_phrases db, query, ( error, phrases ) =>\n    return handler error if error?\n    return handler null, fallback if ( phrases.length is 0 ) and ( fallback isnt @_misfit )\n    return handler new Error \"expected 1 phrase, got #{phrases.length}\" if phrases.length isnt 1\n    handler null, phrases[ 0 ]\n\n#-----------------------------------------------------------------------------------------------------------\n@_create_phrasestream = ( db, query, handler ) ->\n  input = @create_facetstream db, query\n  R = input.pipe @$as_phrase db\n  if handler?\n    R = R\n      .pipe D.$collect()\n      .pipe $ ( data, send ) =>\n        handler null, data\n    R.on 'error', ( error ) => handler error\n  R[ '%meta' ] = input[ '%meta' ]\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@create_facetstream = ( db, query ) ->\n  ###\n  * If none of `lo`, `hi` or 'prefix' are given, the stream will iterate over all entries.\n  * If both `lo` and `hi` are given, a query with lower and upper, inclusive boundaries (in LevelDB these\n    are called `gte` and `lte`, repsectively) is issued.\n  * If only `prefix` is given, a prefix query is issued. Prefix queries may be 'exclusive' or 'inclusive'.\n    Exclusive prefixes match the list elements that make up the HOLLERITH entry keys in a component-wise\n    fashion, while inclusive queries also match when the last prefix element is the start of the\n    corresponding component of the entry key. For example, `{ prefix: [ 'pos', 'shape', ] }` will match\n    only entries whose first two key elements are `'pos'` and `'shape'`, while a query using\n    `{ prefix: [ 'pos', 'shape', ], star: '*', }` will additionally match entries with such keys as\n    `[ 'pos', 'shapeclass', ]` and `[ 'pos', 'shape/strokeorder', ]`.\n  * If only `lo` or only `hi` is given, an error is issued.\n  ###\n  lo_hint = null\n  hi_hint = null\n  #.........................................................................................................\n  if query?\n    keys = Object.keys query\n    switch arity = keys.length\n      when 1\n        switch key = keys[ 0 ]\n          when 'prefix'\n            lo_hint = query[ key ]\n          when 'lo', 'prefix'\n            throw new Error \"illegal to specify `lo` but not `hi`\"\n            # lo_hint = query[ key ]\n          when 'hi'\n            throw new Error \"illegal to specify `hi` but not `lo`\"\n            # hi_hint = query[ key ]\n          else\n            throw new Error \"unknown hint key #{rpr key}\"\n      when 2\n        keys.sort()\n        if keys[ 0 ] is 'hi' and keys[ 1 ] is 'lo'\n          lo_hint = query[ 'lo' ]\n          hi_hint = query[ 'hi' ]\n        else if keys[ 0 ] is 'prefix' and keys[ 1 ] is 'star'\n          lo_hint = query[ 'prefix' ]\n          hi_hint = query[ 'star' ]\n          throw new Error \"expected `star` to be '*', got #{rpr hi_hint}\" unless hi_hint is '*'\n        else\n          throw new Error \"illegal hint keys #{rpr keys}\"\n      else\n        throw new Error \"illegal hint arity #{rpr arity}\"\n  #.........................................................................................................\n  # debug '©KaWp7', lo_hint, hi_hint\n  return @_create_facetstream db, lo_hint, hi_hint\n\n#-----------------------------------------------------------------------------------------------------------\n@_create_facetstream = ( db, lo_hint = null, hi_hint = null ) ->\n  ### TAINT `lo_hint` and `hi_hint` should be called `first` and `second` ###\n  #.........................................................................................................\n  if hi_hint? and not lo_hint?\n    throw new Error \"must give `lo_hint` when `hi_hint` is given\"\n  #.........................................................................................................\n  if lo_hint? and not hi_hint?\n    query       = @_query_from_prefix db, lo_hint\n  #.........................................................................................................\n  else if lo_hint? and hi_hint is '*'\n    query       = @_query_from_prefix db, lo_hint, '*'\n  #.........................................................................................................\n  else\n    lo_hint_bfr = if lo_hint? then (        @_encode_key db, lo_hint )          else null\n    hi_hint_bfr = if hi_hint? then ( @_query_from_prefix db, hi_hint )[ 'lte' ] else null\n    # lo_hint_bfr = if lo_hint? then (        @_encode_key db, lo_hint )          else CODEC[ 'keys' ][ 'lo' ]\n    # hi_hint_bfr = if hi_hint? then ( @_query_from_prefix db, hi_hint )[ 'lte' ] else CODEC[ 'keys' ][ 'hi' ]\n    query       = { gte: lo_hint_bfr, lte: hi_hint_bfr, }\n  #.........................................................................................................\n  ### TAINT Should we test for well-formed entries here? ###\n  R = db[ '%self' ].createReadStream query\n  #.........................................................................................................\n  R = R.pipe $ ( { key, value }, send ) =>\n    unless @_is_meta db, key\n      send [ ( @_decode_key db, key ), ( @_decode_value db, value ), ]\n  #.........................................................................................................\n  R[ '%meta' ] = {}\n  R[ '%meta' ][ 'query' ] = query\n  #.........................................................................................................\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@has = ( db, key, handler ) ->\n  key_bfr = if CND.isa_jsbuffer then key else @_encode_key db, key\n  db[ '%self' ].get key_bfr, ( error, obj_bfr ) =>\n    if error?\n      return handler null, false if error[ 'type' ] is 'NotFoundError'\n      return handler error\n    handler null, true\n\n# #-----------------------------------------------------------------------------------------------------------\n# @ensure_new_key = ( db, key, handler ) ->\n#   key_bfr = if CND.isa_jsbuffer then key else @_encode_key db, key\n#   db[ '%self' ].get key_bfr, ( error, obj_bfr ) =>\n#     if error?\n#       return handler null if error[ 'type' ] is 'NotFoundError'\n#       return handler error\n#     obj = @_decode_value obj_bfr\n#     handler new Error \"key #{rpr key} already in DB with value #{rpr obj}\"\n\n#-----------------------------------------------------------------------------------------------------------\n@read_sub = ( db, settings, read ) ->\n  switch arity = arguments.length\n    when 2\n      read      = settings\n      settings  = null\n    when 3\n      null\n    else\n      throw new Error \"expected 2 or 3 arguments, got #{arity}\"\n  #.........................................................................................................\n  indexed           = settings?[ 'indexed'    ] ? no\n  # transform         = settings?[ 'transform'  ] ? D.$pass_through()\n  mangle            = settings?[ 'mangle'     ] ? ( data ) -> data\n  send_empty        = settings?[ 'empty'      ] ? no\n  insert_index      = if indexed then D.new_indexer() else ( x ) -> x\n  open_stream_count = 0\n  #.........................................................................................................\n  return $ ( outer_data, outer_send, outer_end ) =>\n    count = 0\n    #.......................................................................................................\n    if outer_data?\n      open_stream_count    += +1\n      sub_input             = read outer_data\n      [ memo, sub_input, ]  = if CND.isa_list sub_input then sub_input else [ @_misfit, sub_input, ]\n      sub_input\n        # .pipe transform\n        .pipe do =>\n          ### TAINT no need to build buffer if not `send_empty` and there are no results ###\n          buffer = if memo is @_misfit then [] else [ memo, ]\n          return $ ( inner_data, _, inner_end ) =>\n            if inner_data?\n              inner_data = mangle inner_data\n              if inner_data?\n                count += +1\n                buffer.push inner_data\n            if inner_end?\n              if send_empty or count > 0\n                outer_send insert_index buffer\n              open_stream_count += -1\n              inner_end()\n    #.......................................................................................................\n    if outer_end?\n      repeat_immediately ->\n        return true unless open_stream_count is 0\n        outer_end()\n        return false\n\n\n#===========================================================================================================\n# KEYS & VALUES\n#-----------------------------------------------------------------------------------------------------------\n@_encode_key = ( db, key, extra_byte ) ->\n  throw new Error \"illegal key #{rpr key}\" if key is undefined\n  return _codec_encode key, extra_byte\n\n#-----------------------------------------------------------------------------------------------------------\n@_decode_key = ( db, key ) ->\n  throw new Error \"illegal key #{rpr key}\" if ( R = _codec_decode key ) is undefined\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@_encode_value = ( db, value      ) -> new Buffer ( JSON.stringify value ), 'utf-8'\n@_decode_value = ( db, value_bfr  ) -> JSON.parse value_bfr.toString 'utf-8'\n\n#-----------------------------------------------------------------------------------------------------------\n### NB Argument ordering for these function is always subject before object, regardless of the phrasetype\nand the ordering in the resulting key. ###\n@new_key = ( db, phrasetype, sk, sv, ok, ov, idx ) ->\n  throw new Error \"illegal phrasetype: #{rpr phrasetype}\" unless phrasetype in [ 'so', 'os', ]\n  [ sk, sv, ok, ov, ] = [ ok, ov, sk, sv, ] if phrasetype is 'os'\n  return [ phrasetype, sk, sv, ok, ov, ( idx ? 0 ), ]\n\n#-----------------------------------------------------------------------------------------------------------\n@new_so_key = ( db, P... ) -> @new_key db, 'so', P...\n@new_os_key = ( db, P... ) -> @new_key db, 'os', P...\n\n#-----------------------------------------------------------------------------------------------------------\n@_new_os_key_from_so_key = ( db, so_key ) ->\n  [ phrasetype, sk, sv, ok, ov, idx, ] = @as_phrase db, so_key\n  throw new Error \"expected phrasetype 'so', got #{rpr phrasetype}\" unless phrasetype is 'so'\n  return [ 'os', ok, ov, sk, sv, idx, ]\n\n#-----------------------------------------------------------------------------------------------------------\n@new_keys = ( db, phrasetype, sk, sv, ok, ov, idx ) ->\n  other_phrasetype  = if phrasetype is 'so' then 'os' else 'so'\n  return [\n    ( @new_key db,       phrasetype, sk, sv, ok, ov, idx ),\n    ( @new_key db, other_phrasetype, sk, sv, ok, ov, idx ), ]\n\n#-----------------------------------------------------------------------------------------------------------\n@as_phrase = ( db, key, value, normalize = yes ) ->\n  switch phrasetype = key[ 0 ]\n    when 'spo'\n      throw new Error \"illegal SPO key (length #{length})\" unless ( length = key.length ) is 3\n      throw new Error \"illegal value (1) #{rpr value}\" if value in [ undefined, ]\n      return [ phrasetype, key[ 1 ], key[ 2 ], value, ]\n    when 'pos'\n      throw new Error \"illegal POS key (length #{length})\" unless 4 <= ( length = key.length ) <= 5\n      throw new Error \"illegal value (2) #{rpr value}\" if not ( value in [ null, ] )\n      return [ phrasetype, key[ 3 ], key[ 1 ], key[ 2 ], key[ 4 ], ] if key[ 4 ]?\n      return [ phrasetype, key[ 3 ], key[ 1 ], key[ 2 ], ]\n\n#-----------------------------------------------------------------------------------------------------------\n@$as_phrase = ( db ) ->\n  return $ ( data, send ) =>\n    send @as_phrase db, data...\n\n#-----------------------------------------------------------------------------------------------------------\n@key_from_url = ( db, url ) ->\n  ### TAINT does not unescape as yet ###\n  ### TAINT does not cast values as yet ###\n  ### TAINT does not support multiple indexes as yet ###\n  [ phrasetype, first, second, idx, ] = url.split '|'\n  unless phrasetype? and phrasetype.length > 0 and phrasetype in [ 'so', 'os', ]\n    throw new Error \"illegal URL key #{rpr url}\"\n  unless first? and first.length > 0 and second? and second.length > 0\n    throw new Error \"illegal URL key #{rpr url}\"\n  idx = if ( idx? and idx.length > 0 ) then ( parseInt idx, 10 ) else 0\n  [ sk, sv, ] =  first.split ':'\n  [ ok, ov, ] = second.split ':'\n  unless sk? and sk.length > 0 and ok? and ok.length > 0\n    throw new Error \"illegal URL key #{rpr url}\"\n  [ sk, sv, ok, ov, ] = [ ok, ov, sk, sv, ] if phrasetype is 'os'\n  return [ phrasetype, sk, sv, ok, ov, idx, ]\n\n#-----------------------------------------------------------------------------------------------------------\n@url_from_key = ( db, key ) ->\n  if ( @_type_from_key db, key ) is 'list'\n    [ phrasetype, tail..., ] = key\n    if phrasetype is 'spo'\n      [ sbj, prd, ] = tail\n      return \"spo|#{sbj}|#{prd}|\"\n    else\n      [ prd, obj, sbj, idx, ] = tail\n      idx_rpr = if idx? then rpr idx else ''\n      return \"pos|#{prd}:#{obj}|#{sbj}|#{idx_rpr}\"\n  return \"#{rpr key}\"\n\n#-----------------------------------------------------------------------------------------------------------\n@$url_from_key = ( db ) -> $ ( key, send ) => send @url_from_key db, key\n@$key_from_url = ( db ) -> $ ( url, send ) => send @key_from_url db, key\n\n#-----------------------------------------------------------------------------------------------------------\n@_type_from_key = ( db, key ) ->\n  if Array.isArray key\n    # throw new Error \"illegal key: #{rpr key}\" unless key.length is 6\n    throw new Error \"illegal phrasetype: #{rpr key}\" unless key[ '0' ] in @phrasetypes\n    return 'list'\n  return 'other'\n\n\n#===========================================================================================================\n# PREFIXES & QUERIES\n#-----------------------------------------------------------------------------------------------------------\n@_query_from_prefix = ( db, prefix, star ) ->\n  if star?\n    ### 'Asterisk' encoding: partial key segments match ###\n    gte   = @_encode_key db, prefix\n    lte   = @_encode_key db, prefix\n    lte[ lte.length - 1 ] = CODEC[ 'typemarkers'  ][ 'hi' ]\n  #.........................................................................................................\n  else\n    ### 'Classical' encoding: only full key segments match ###\n    base  = @_encode_key db, prefix, CODEC[ 'typemarkers'  ][ 'hi' ]\n    gte   = base.slice 0, base.length - 1\n    lte   = base.slice 0, base.length\n  #.........................................................................................................\n  return { gte, lte, }\n\n\n\n\n\n"]}